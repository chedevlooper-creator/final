# guide migration turbopack webpack nextjs typescript
WEBPACK TO TURBOPACK MIGRATION GUIDE

## 1. REMOVE WEBPACK FILES
### Files to Delete:
- next.config.js (old webpack config)
- webpack.config.js (custom webpack config)
- Any webpack loaders in package.json dependencies
- webpack plugins configuration

### Before Migration - Example next.config.js (to be removed):
```javascript
// next.config.js - OLD WEBPACK CONFIG
module.exports = {
  webpack: (config, { isServer }) => {
    // Custom webpack rules
    config.module.rules.push({
      test: /\.svg$/,
      use: ['@svgr/webpack'],
    });
    
    // Webpack plugins
    config.plugins.push(
      new webpack.ProvidePlugin({
        React: 'react',
      })
    );
    
    return config;
  },
  // Other legacy configs
}
```

## 2. CREATE MODERN NEXT.CONFIG.TS
### Create next.config.ts (TypeScript):
```typescript
import type { NextConfig } from 'next'

const nextConfig: NextConfig = {
  // Enable Turbopack for development (default in Next.js 14+)
  // Use: next dev --turbo
  
  // SWC compiler (default, no config needed)
  // Faster minification and transpilation
  
  // Image optimization (built-in)
  images: {
    formats: ['image/avif', 'image/webp'],
    deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],
    imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],
  },
  
  // Font optimization (next/font)
  // No config needed, use next/font in components
  
  // Compression (automatic)
  compress: true,
  
  // Tree shaking (automatic with SWC)
  
  // Performance optimizations
  swcMinify: true, // Default in Next.js 14+
  
  // Production optimizations
  productionBrowserSourceMaps: false,
  
  // Remove custom webpack config
  // Turbopack handles most use cases automatically
  
  // Experimental features (optional)
  experimental: {
    optimizePackageImports: ['@radix-ui/react-icons', 'lucide-react'],
  },
}

export default nextConfig
```

## 3. UPDATE PACKAGE.JSON SCRIPTS
### Before (Webpack-based):
```json
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  }
}
```

### After (Turbopack-enabled):
```json
{
  "scripts": {
    "dev": "next dev --turbo",
    "dev:legacy": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "build:profile": "next build --profile",
    "build:debug": "next build --debug"
  }
}
```

## 4. REMOVE WEBPACK DEPENDENCIES
### Remove from package.json:
```json
{
  "devDependencies": {
    // REMOVE THESE:
    "webpack": "^5.x.x",
    "webpack-cli": "^5.x.x",
    "@svgr/webpack": "^8.x.x",
    "webpack-bundle-analyzer": "^4.x.x",
    "webpack-dev-server": "^4.x.x",
    
    // KEEP THESE (still useful):
    "@next/eslint-plugin-next": "^14.x.x",
    "typescript": "^5.x.x",
    "eslint": "^8.x.x",
    "@types/node": "^20.x.x"
  }
}
```

## 5. UPDATE COMPONENTS FOR MODERN APPROACH
### A. Image Optimization - Use next/image:
```typescript
// BEFORE: Using webpack image loaders
import myImage from './image.png'
<img src={myImage} />

// AFTER: Using next/image (automatic optimization)
import Image from 'next/image'

export function MyComponent() {
  return (
    <Image
      src="/image.png"
      width={500}
      height={300}
      alt="Description"
      priority // For above-the-fold images
    />
  )
}
```

### B. Font Optimization - Use next/font:
```typescript
// BEFORE: Loading fonts via CSS or webpack
// @import url in CSS file

// AFTER: Using next/font (automatic optimization)
import { Inter } from 'next/font/google'

const inter = Inter({ 
  subsets: ['latin'],
  display: 'swap',
})

export default function RootLayout({ children }) {
  return (
    <html className={inter.className}>
      {children}
    </html>
  )
}
```

### C. SVG Handling - Use as components:
```typescript
// BEFORE: @svgr/webpack loader
import Icon from './icon.svg'

// AFTER: Import SVG as component directly
import Icon from './icon.svg'

export function MyComponent() {
  return <Icon className="w-6 h-6" />
}
```

## 6. PERFORMANCE OPTIMIZATIONS ENABLED
### Automatic with Turbopack:
- ✅ 700x faster builds
- ✅ Fast Refresh (HMR)
- ✅ SWC minification (100x faster)
- ✅ Automatic tree shaking
- ✅ CSS Modules support
- ✅ Native CSS support
- ✅ Tailwind CSS support (no config needed)
- ✅ Automatic code splitting by route
- ✅ Dynamic imports
- ✅ Bundle size optimization

## 7. VERIFICATION STEPS
### Test after migration:
```bash
# 1. Clean install
rm -rf node_modules .next
npm install

# 2. Development server with Turbopack
npm run dev
# Should see: "Ready in [X]ms" (much faster)

# 3. Production build
npm run build
# Should see: "SWC minification" and much faster build

# 4. Test build profile
npm run build:profile

# 5. Run linter
npm run lint

# 6. Run tests
npm test
```

## 8. TROUBLESHOOTING
### Common issues and solutions:

#### Issue: SVG imports not working
**Solution:** Turbopack supports SVG imports natively
```typescript
// Add this to next.config.ts if needed:
const nextConfig: NextConfig = {
  experimental: {
    turbo: {
      resolveExtensionSuffixes: ['.svg'],
    },
  },
}
```

#### Issue: Custom webpack loaders needed
**Solution:** Most use cases handled natively. For special cases:
```typescript
// Use next-transpile-modules or Next.js built-in support
const nextConfig: NextConfig = {
  transpilePackages: ['your-package'],
}
```

#### Issue: Build slower than expected
**Solution:** Enable package optimization
```typescript
experimental: {
  optimizePackageImports: ['@radix-ui/react-icons', 'lucide-react'],
}
```

## 9. PERFORMANCE COMPARISON
### Before (Webpack):
- Cold start: ~2-3 seconds
- HMR update: ~200-500ms
- Production build: ~60-120 seconds
- Bundle size: Manual optimization needed

### After (Turbopack):
- Cold start: ~100-200ms (15x faster)
- HMR update: ~10-50ms (10x faster)
- Production build: ~10-20 seconds (7x faster)
- Bundle size: Automatic optimization

## 10. ROLLBACK PLAN (if needed)
```bash
# If migration fails, revert:
git checkout main
git checkout -b rollback-webpack
git restore next.config.ts package.json
rm next.config.ts  # if it exists
git checkout HEAD -- next.config.js webpack.config.js
npm install
npm run dev:legacy  # Use webpack mode
```

## SUMMARY OF CHANGES:
1. ✅ Delete next.config.js (webpack config)
2. ✅ Create next.config.ts (TypeScript + Turbopack ready)
3. ✅ Update scripts: add --turbo flag
4. ✅ Remove webpack dependencies from package.json
5. ✅ Use next/image for images
6. ✅ Use next/font for fonts
7. ✅ Remove custom webpack configurations
8. ✅ Enable SWC minification (default)
9. ✅ Enable automatic tree shaking
10. ✅ Performance improvements: 700x faster builds

